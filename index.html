<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Sistema Agr√≠cola</title>

    <!-- RESPONSIVE -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ESTILOS -->
    <link rel="stylesheet" href="styles.css" />

    <!-- FAVICON (opcional si existe archivo) -->
    <link rel="icon" href="favicon.ico" />
  </head>

  <body>
    <!-- LOGIN -->
    <div id="login" class="card">
      <h2>Ingreso Contratista</h2>

      <input
        type="password"
        id="password"
        placeholder="Contrase√±a"
        autocomplete="off"
      />

      <button type="button" onclick="loginUser()">Ingresar</button>
    </div>

    <!-- APP -->
    <div id="app" class="hidden layout">
      <!-- MEN√ö LATERAL -->
      <aside class="sidebar">
        <h2>üå± Sistema</h2>

        <button type="button" onclick="showView('viewHome')">üè† Inicio</button>
        <button type="button" onclick="showView('viewWorkers')">
          üë®‚Äçüåæ Trabajadores
        </button>
        <button type="button" onclick="showView('viewWorkersDB')">
          üìã Base de Datos Trabajadores
        </button>
        <button type="button" onclick="showView('viewProduction')">
          üõ†Ô∏è Producci√≥n
        </button>
        <button type="button" onclick="showView('viewLiquidation')">
          üìÑ Liquidaci√≥n
        </button>
        <button type="button" onclick="showView('viewMonthly')">
          üìÖ Mensual Trabajador
        </button>
        <button type="button" onclick="showView('viewMonthlyGeneral')">
          üßæ Mensual General
        </button>
        <button type="button" onclick="showView('viewWeekly')">
          üìä Resumen Semanal
        </button>
        <button type="button" onclick="showView('viewHistory')">
          üìú Historial
        </button>
        <button type="button" onclick="showView('viewBackup')">
          üíæ Respaldo
        </button>
        <button type="button" onclick="showView('viewContract')">üßæ Contrato</button>
        <button type="button" onclick="showView('viewFiniquito')">üìë Finiquito</button>
      </aside>

      <!-- CONTENIDO -->
      <main class="content">
        <header>
          <h1>Sistema de Producci√≥n Agr√≠cola</h1>
          <button type="button" onclick="logout()">Cerrar sesi√≥n</button>
        </header>

        <!-- INICIO -->
        <section class="view" id="viewHome">
          <div class="company-header">
            <div class="company-logo">
              <img
                src="img/logo-san-geronimo.png"
                alt="Servicios Agr√≠colas San Ger√≥nimo SPA"/>
            </div>

            <div class="company-text">
              <h1>SERVICIOS AGR√çCOLAS SAN GER√ìNIMO SPA</h1>
              <p class="company-slogan">Gesti√≥n agr√≠cola con confianza y precisi√≥n</p>
            </div>
          </div>

          <div class="homeScreen">
            <h2>Bienvenido al Sistema Agr√≠cola</h2>
            <p><strong>Seleccione una opci√≥n del men√∫ lateral</strong></p>
          </div>

          <div class="company-review">
            <p>
              <strong>SERVICIOS AGR√çCOLAS SAN GER√ìNIMO SPA</strong> es una
              empresa contratista especializada en la provisi√≥n y gesti√≥n de
              personal para faenas agr√≠colas, comprometida con la eficiencia, la
              responsabilidad y el cumplimiento de las normativas laborales
              vigentes.
            </p>
            <p>
              Nuestra labor se enfoca en coordinar, supervisar y administrar
              trabajadores agr√≠colas en distintas etapas productivas,
              garantizando un servicio confiable tanto para productores como
              para trabajadores.
            </p>
            <p>
              Este sistema permite mantener un control preciso de la producci√≥n,
              pagos y registros laborales, asegurando una gesti√≥n moderna,
              transparente y profesional.
            </p>
          </div>

        </section>

        <!-- TRABAJADORES -->
        <section class="card view hidden" id="viewWorkers">
          <h2>Registrar Trabajador</h2>

          <select id="workerEditSelect" onchange="loadWorkerToEdit()">
            <option value="">-- Seleccionar para editar --</option>
          </select>

          <input type="text" id="workerName" placeholder="Nombre" />
          <input
            type="text"
            id="workerRut"
            placeholder="RUT"
            oninput="formatRutInput(this)"
          />
          <input type="text" id="workerAddress" placeholder="Direcci√≥n" />
          <input type="text" id="workerAFP" placeholder="AFP" />
          <input type="text" id="workerHealth" placeholder="Salud (Fonasa / Isapre)" />
          <input type="text" id="workerPosition" placeholder="Cargo" />
          <input type="text" id="workerBaseSalary" placeholder="Sueldo Base" />
          <input type="date" id="workerEntryDate" placeholder="Fecha ingreso" />
          <button type="button" onclick="addWorker()">Guardar</button>
          <button type="button" onclick="clearWorkerForm()" style="background: #7f8c8d">Limpiar</button>
          <button type="button" onclick="deleteWorker()" style="background: #c0392b">Eliminar Trabajador</button>
        </section>

        <!-- BASE DE DATOS -->
        <section class="card view hidden" id="viewWorkersDB">
          <h2>Base de Datos de Trabajadores</h2>
          <div id="workersTable"></div>
        </section>

        <!-- PRODUCCI√ìN -->
        <section class="card view hidden" id="viewProduction">
          <h2>Registrar Producci√≥n</h2>
          <select id="workerSelect">
            <option value="">-- Seleccionar trabajador --</option>
          </select>

          <input type="date" id="workDate" />

          <select id="laborSelect">
            <option value="">-- Seleccionar labor --</option>
          </select>

          <input type="text" id="newLabor" placeholder="Nueva labor (opcional)"/>
          <input type="number" id="quantity" placeholder="Cantidad" min="0" step="1"/>
          <input type="text" id="unitValue" placeholder="Valor por unidad" oninput="formatCurrency(this)"/>
          <input type="text" id="observation" placeholder="Observaci√≥n" />
          <button type="button" onclick="registerWork()">Registrar</button>
          <button type="button" onclick="loadDailyRecords()"> üîç Buscar registros del d√≠a</button>

          <div id="dailyRecordsResult"></div>
        </section>

        <!-- LIQUIDACI√ìN -->
        <section class="card view hidden" id="viewLiquidation">
            <div id="liquidationPrint" class="liquidacion-doc hidden"></div>
            <h2>Liquidaci√≥n Mensual</h2>

            <select id="workerLiquidation">
              <option value="">-- Seleccionar trabajador --</option>
            </select>

            <input type="month" id="monthLiquidation" />
            <input type="text" id="advanceAmount" placeholder="Anticipos del mes"/>
            <button type="button" onclick="generateLiquidation()"> Generar Liquidaci√≥n</button>
            <button type="button" onclick="window.print()" class="no-print">üñ®Ô∏è Imprimir Liquidaci√≥n</button>
        </section>

        <!-- CONTRATO -->
        <section class="card view hidden" id="viewContract">
          <div id="contractPrint">
            <h2 class="titulo-contrato">Contrato de Trabajo de Temporada</h2>
            <p>
              En Santiago, a ____ de __________________ de 20____, entre
              SERVICIOS AGRICOLAS SAN GERONIMO SPA, RUT N¬∫ 78.018.478-7 con
              domicilio en 1 Sur 690 of 815 Edificio Oficina Plaza Talca comuna
              Talca que adelante se denominar√° "<b>el empleador</b>", y don(a)
              _________________________________,C√©dula de Identidad n¬∞
              ______________________, Nacionalidad ______________________,Estado
              Civil ______________________, fecha de Nacimiento ____ / ____ /
              20____, de oficio trabajador Agr√≠cola, con domicilio en
              _________________________________, que adelante se denominar√°
              <b>"el trabajador"</b>, se ha convenido en el siguiente contrato
              de trabajo de temporada o de faena transitoria.
            </p>
            <p class="clausula">
              <b>PRIMERO:</b>
              El trabajador prestar√° sus servicios como Trabajador Agr√≠cola en
              Avda Miguel Vial Echenique s/n comuna de Coltauco.
            </p>
            <p class="clausula">
              <b>SEGUNDO:</b>
              El presente contrato se entender√° terminado autom√°ticamente, en la
              fecha en que concluyen las faenas que le dieron origen y a que se
              ha hecho referencia en la cl√°usula primera, sin perjuicio que el
              empleador comunique por escrito este hecho, de conformidad con lo
              dispuesto en el art√≠culo 162 del C√≥digo del Trabajo.
            </p>
            <p class="clausula">
              <b>TERCERO:</b>
              La jornada ordinaria de trabajo ser√° de 44 horas semanales
              distribuidas de la siguiente forma: lunes a Jueves de 07:00 a
              12:00 y de 13:00 a 16:00 hrs. Y Viernes de 7: a 12:00 y de 13:00 a
              15:30 hrs.
            </p>
            <p class="clausula">
              <b>CUARTO:</b>
              El empleador se compromete a remunerar los servicios del
              trabajador con un sueldo de ____________
              (___________________________________), que ser√° liquidado y
              pagado, por per√≠odos vencidos en forma proporcional a los d√≠as
              efectivamente trabajados.
            </p>
            <p class="clausula">
              <b>QUINTO:</b> El empleador se compromete a otorgar o suministrar
              al trabajador los siguientes beneficios: Traslado desde la casa al
              trabajo y del trabajo a la casa.-
            </p>
            <p class="clausula">
              <b>SEXTO:</b> Cuando por necesidades de funcionamiento de la
              Empresa, sea necesario pactar trabajo en tiempo extraordinario, el
              trabajador que lo acuerde, se obligar√° a cumplir el horario que al
              efecto determinen con la Empleadora, dentro de los l√≠mites
              legales. Dicho acuerdo constar√° por escrito y se firmar√° por ambas
              partes, previamente a la realizaci√≥n del trabajo.
            </p>
            <p class="clausula">
              <b>SEPTIMO:</b> Queda prohibido expresamente al trabajador laborar
              sobre-tiempo o simplemente permanecer en el recinto de la Empresa,
              despu√©s de la hora diaria de salida, salvo en los casos a que se
              refiere el inciso precedente
            </p>
            <p class="clausula">
              <b>OCTAVO:</b> De acuerdo al art√≠culo 38, N¬∫ 3 del C√≥digo del
              Trabajo, las partes dejan establecido que la jornada ordinaria
              puede comprender domingos o festivos, atendido el car√°cter de las
              labores frut√≠colas materia del presente contrato.
            </p>
            <p class="clausula">
              <b>NOVENO:</b> Se deja constancia que el trabajador de conformidad
              con lo dispuesto en el art√≠culo 305 del C√≥digo del Trabajo, por la
              naturaleza de las faenas no est√° habilitado para negociar
              colectivamente.
            </p>
            <p class="clausula">
              <b>DECIMO:</b> El trabajador deja constancia que se encuentra
              afiliado para los efectos de su previsi√≥n a AFP ______________ y
              para los efectos de salud a ___________ y reconoce que son de su
              responsabilidad todos los cambios o modificaciones que puedan
              afectar su situaci√≥n previsional o de salud, los que deber√°
              informar oportunamente al Empleador.
            </p>
            <p class="clausula">
              <b>UNDECIMO:</b> Se deja expresa constancia que el trabajador
              ingres√≥ al servicio del empleador el ___/___/20__.
            </p>
            <p class="clausula">
              <b>DUODECIMO:</b> Para todos los efectos derivados del presente
              contrato las partes fijan domicilio en la ciudad de Talca y se
              someten a la Jurisdicci√≥n de sus Tribunales.
            </p>
            <p class="clausula">
              <b>D√âCIMO TERCERO:</b> El presente contrato se firma en 2
              ejemplares, declarando el trabajador haber recibido en este acto
              un ejemplar de dicho instrumento, que es el fiel reflejo de la
              relaci√≥n laboral convenida.
            </p>

            <br /><br /><br />

            <div class="signatures">
                <!-- EMPLEADOR -->
                <div class="sign">
                   <div class="line"></div>

                   <p class="sign-name">Servicios Agr√≠colas San Ger√≥nimo SPA</p>

                   <p class="sign-role">EMPLEADOR</p>

                   <p class="sign-rut">RUT: 78.018.478-7</p>
                </div>

              <!-- TRABAJADOR -->
                <div class="sign">
                  <div class="line"></div>

                  <p class="sign-name">TRABAJADOR</p>
                </div>
            </div>
          </div>
          <button class="no-print" onclick="window.print()">üñ®Ô∏è Imprimir Contrato</button>

          <select id="workerContract">
            <option value="">-- Seleccionar trabajador --</option>
          </select>

          <input type="text" id="faena" placeholder="Faena / Campo" />
          <input type="text" id="cargo" placeholder="Cargo / Labor" />
          <input type="text" id="afp" placeholder="AFP" />
          <input type="date" id="startDate" />
          <input type="text" id="salary" placeholder="Sueldo / Trato" />

          <button type="button" onclick="generateContract()"> Generar Contrato </button>
        </section>

        <!-- MENSUAL -->
        <section class="card view hidden" id="viewMonthly">
          <h2>Resumen Mensual por Trabajador</h2>

          <select id="workerMonthly">
            <option value="">-- Seleccionar trabajador --</option>
          </select>

          <input type="month" id="monthMonthly" />

          <button type="button" onclick="generateMonthlySummary()"> Calcular Mes </button>

          <div id="monthlyResult"></div>
        </section>

        <!-- MENSUAL GENERAL -->
        <section class="card view hidden" id="viewMonthlyGeneral">
          <h2>Resumen Mensual General</h2>

          <input type="month" id="monthGeneral" />

          <button type="button" onclick="generateMonthlyGeneral()"> Calcular Mes </button>
          <button type="button" onclick="printMonthlyGeneral()" class="no-print"> üñ®Ô∏è Imprimir Resumen </button>
          <button type="button" onclick="exportMonthlyGeneralExcel()" class="no-print"> üìä Exportar a Excel </button>
          <div id="monthlyGeneralResult"></div>
        </section>

        <!-- SEMANAL -->
        <section class="card view hidden" id="viewWeekly">
          <h2>Resumen Semanal</h2>

          <button type="button" onclick="showView('viewHistory')"> Ver Historial Completo </button>
          <input type="text" id="searchWorkerWeekly" placeholder="Buscar por nombre o RUT" oninput="filterWorkersWeekly()"/>

          <select id="workerWeekly">
            <option value="">-- Seleccionar trabajador --</option>
          </select>

          <input type="week" id="weekSelected" />
          <button type="button" onclick="generateWeeklySummary()"> Calcular Semana </button>

          <div id="weeklyPrintArea">
            <div id="weeklyResult"></div>
          </div>

          <button onclick="printWeeklySummary()" class="no-print"> üñ®Ô∏è Imprimir Resumen Semanal </button>
        </section>

        <!-- HISTORIAL -->
        <section class="card view hidden" id="viewHistory">
          <h2>Historial</h2>
          <div id="history"></div>
        </section>

        <!-- RESPALDO -->
        <section class="card view hidden" id="viewBackup">
          <h3>Respaldo del Sistema</h3>

          <button type="button" onclick="exportData()"> Exportar Respaldo </button>
          <input type="file" id="importFile" style="display: none" onchange="importData(event)"/>
          <button type="button" onclick="document.getElementById('importFile').click()">Importar Respaldo</button>
        </section>
        <section class="card view hidden" id="viewFiniquito">

    <div id="finiquitoPrint">

        <h2 style="text-align:center;">FINIQUITO TRABAJADOR</h2>

        <p>
        En San Clemente, a ____ de __________________ de 20____,
        entre el empleador SERVICIO AGR√çCOLA SAN GER√ìNIMO SPA,
        con domicilio en 1 SUR 690 OF 815 EDIFICIO OFICINA PLAZA MAULE,
        y el trabajador que se indica por la otra, se acuerda el siguiente finiquito:
        </p>

        <p>
        <strong>PRIMERO:</strong>
        Don(a) ___________________________________________,
        declara haber prestado servicios desde el ____ / ____ / ______
        hasta el ____ / ____ / ______,
        fecha de terminaci√≥n por lo dispuesto en el Art. 159 N¬∞5
        (Conclusi√≥n del trabajo que dio origen al contrato).
        </p>

        <p>
        <strong>SEGUNDO:</strong>
        Con motivo de la terminaci√≥n del contrato,
        el trabajador declara recibir a su entera satisfacci√≥n
        las siguientes sumas:
        </p>

        <br><br>

        <h3 style="text-align:center;">
            TOTAL L√çQUIDO A PAGAR SEG√öN DETALLE LIQUIDACI√ìN
        </h3>

        <h1 style="text-align:center;">
            $ _______________________
        </h1>

        <br><br><br>

        <div class="signatures">

            <div class="sign">
                <div class="line"></div>
                <p class="sign-name">TRABAJADOR</p>
            </div>

            <div class="sign">
                <div class="line"></div>
                <p class="sign-name">SERVICIOS AGR√çCOLAS SAN GER√ìNIMO SPA</p>
                <p class="sign-rut">RUT: 78.018.478-7</p>
            </div>

        </div>

    </div>

    <button class="no-print" onclick="window.print()">
        üñ®Ô∏è Imprimir Finiquito
    </button>

</section>
      </main>
    </div>

    <!-- LIBRER√çA PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- APP JS -->
    <script src="app.js"></script>
  </body>
</html>
