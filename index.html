<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Agr√≠cola</title>

    <!-- RESPONSIVE -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="favicon.ico">
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
    <h2>Ingreso Contratista</h2>
    <input type="password" id="password" placeholder="Contrase√±a">
    <button onclick="loginUser()">Ingresar</button>
</div>

<!-- APP -->
<div id="app" class="hidden layout">

    <!-- MEN√ö LATERAL -->
    <aside class="sidebar">
        <h2>üå± Sistema</h2>

        <button onclick="showView('viewHome')">üè† Inicio</button>
        <button onclick="showView('viewWorkers')">üë®‚Äçüåæ Trabajadores</button>
        <button onclick="showView('viewWorkersDB')">üìã Base de Datos Trabajadores</button>
        <button onclick="showView('viewProduction')">üõ†Ô∏è Producci√≥n</button>
        <button onclick="showView('viewLiquidation')">üìÑ Liquidaci√≥n</button>
        <button onclick="showView('viewMonthly')">üìÖ Mensual Trabajador</button>
        <button onclick="showView('viewMonthlyGeneral')">üßæ Mensual General</button>
        <button onclick="showView('viewWeekly')">üìä Semanal</button>
        <button onclick="showView('viewHistory')">üìú Historial</button>
        <button onclick="showView('viewBackup')">üíæ Respaldo</button>
        <button onclick="showView('viewContract')">üßæ Contrato</button>
    </aside>

    <!-- CONTENIDO -->
    <main class="content">

        <header>
            <h1>Sistema de Producci√≥n Agr√≠cola</h1>
            <button onclick="logout()">Cerrar sesi√≥n</button>
        </header>

        <!-- INICIO -->
        <section class="view" id="viewHome">
            <div class="homeScreen">
                <h2>Bienvenido al Sistema Agr√≠cola</h2>
                <p>Seleccione una opci√≥n del men√∫ lateral</p>
            </div>
        </section>

        <!-- TRABAJADORES -->
        <section class="card view hidden" id="viewWorkers">
            <h2>Registrar Trabajador</h2>

            <select id="workerEditSelect" onchange="loadWorkerToEdit()">
                <option value="">-- Seleccionar para editar --</option>
            </select>

            <input type="text" id="workerName" placeholder="Nombre">
            <input type="text" id="workerRut" placeholder="RUT" oninput="formatRutInput(this)">
            <input type="text" id="workerAddress" placeholder="Direcci√≥n">

            <button onclick="addWorker()">Guardar</button>
            <button onclick="deleteWorker()" style="background:#c0392b">
                Eliminar Trabajador
            </button>
        </section>

        <!-- BASE DE DATOS -->
        <section class="card view hidden" id="viewWorkersDB">
            <h2>Base de Datos de Trabajadores</h2>
            <div id="workersTable"></div>
        </section>

        <!-- PRODUCCI√ìN -->
        <section class="card view hidden" id="viewProduction">
            <h2>Registrar Producci√≥n</h2>

            <select id="workerSelect"></select>
            <input type="date" id="workDate">
            <select id="laborSelect"></select>
            <input type="text" id="newLabor" placeholder="Nueva labor (opcional)">
            <input type="number" id="quantity" placeholder="Cantidad">
            <input type="text" id="unitValue" placeholder="Valor por unidad" oninput="formatCurrency(this)">
            <input type="text" id="observation" placeholder="Observaci√≥n">

            <button onclick="registerWork()">Registrar</button>
            <button onclick="editLastProduction()">‚úèÔ∏è Modificar √∫ltimo</button>
            <button onclick="deleteLastProduction()" style="background:#c0392b">
                üóëÔ∏è Eliminar √∫ltimo
            </button>
        </section>

        <!-- LIQUIDACI√ìN -->
        <section class="card view hidden" id="viewLiquidation">
            <h2>Liquidaci√≥n Mensual</h2>

            <select id="workerLiquidation"></select>
            <input type="month" id="monthLiquidation">

            <button onclick="generateLiquidation()">
                Generar PDF
            </button>
        </section>

        <!-- CONTRATO -->
        <section class="card view hidden" id="viewContract">

    <div id="contractPrint">
            <h2 class="titulo-contrato">Contrato de Trabajo de Temporada</h2>
        <p>
        En Santiago, a ____ de __________________ de 20____,
        entre SERVICIOS AGRICOLAS SAN GERONIMO SPA, RUT N¬∫ 78.018.478-7 con domicilio en 1 Sur 690 of 815 Edificio Oficina Plaza Talca comuna Talca que adelante se denominar√° "<b>el empleador</b>", y don(a) _________________________________,C√©dula de Identidad n¬∞ ______________________, Nacionalidad ______________________,Estado Civil ______________________, fecha de Nacimiento ____ / ____ / 20____, de oficio trabajador Agr√≠cola, con domicilio en _________________________________, que adelante se denominar√° <b>"el trabajador"</b>, se ha convenido en el siguiente contrato de trabajo de temporada o de faena transitoria. 
        </p>
        <p class="clausula">
        <b>PRIMERO:</b> 
        El trabajador prestar√° sus servicios como Trabajador Agr√≠cola en Avda Miguel Vial Echenique s/n comuna de Coltauco.
        </p>
        <p class="clausula">
        <b>SEGUNDO:</b>  
        El presente contrato se entender√° terminado autom√°ticamente, en la fecha en que concluyen las faenas que le dieron origen y a que se ha hecho referencia en la cl√°usula primera, sin perjuicio que el empleador comunique por escrito este hecho, de conformidad con lo dispuesto en el art√≠culo 162 del C√≥digo del Trabajo. 
        </p>
        <p class="clausula">
        <b>TERCERO:</b>  
        La jornada ordinaria de trabajo ser√° de 44 horas semanales distribuidas de la siguiente forma: lunes a Jueves de 07:00 a 12:00 y de 13:00 a 16:00 hrs. Y Viernes de 7: a 12:00 y de 13:00 a 15:30 hrs.
        </p>
        <p class="clausula">
        <b>CUARTO:</b>  
        El empleador se compromete a remunerar los servicios del trabajador con un sueldo de $539.000.- (Quinientos veintinueve mil pesos), que ser√° liquidado y pagado, por per√≠odos vencidos en forma proporcional a los d√≠as efectivamente trabajados. 
        </p>
        <p class="clausula">  
        <b>QUINTO:</b> El empleador se compromete a otorgar o suministrar al trabajador los siguientes beneficios: Traslado desde la casa al trabajo y del trabajo a la casa.- 
        </p>
        <p class="clausula">  
        <b>SEXTO:</b> Cuando por necesidades de funcionamiento de la Empresa, sea necesario pactar trabajo en tiempo extraordinario, el trabajador que lo acuerde, se obligar√° a cumplir el horario que al efecto determinen con la Empleadora, dentro de los l√≠mites legales. Dicho acuerdo constar√° por escrito y se firmar√° por ambas partes, previamente a la realizaci√≥n del trabajo.  
        </p>
        <p class="clausula">  
        <b>SEPTIMO:</b> Queda prohibido expresamente al trabajador laborar sobre-tiempo o simplemente permanecer en el recinto de la Empresa, despu√©s de la hora diaria de salida, salvo en los casos a que se refiere el inciso precedente
        </p>
        <p class="clausula">  
        <b>OCTAVO:</b> De acuerdo al art√≠culo 38, N¬∫ 3 del C√≥digo del Trabajo, las partes dejan establecido que la jornada ordinaria puede comprender domingos o festivos, atendido el car√°cter de las labores frut√≠colas materia del presente contrato. 
        </p>
        <p class="clausula">  
        <b>NOVENO:</b> Se deja constancia que el trabajador de conformidad con lo dispuesto en el art√≠culo 305 del C√≥digo del Trabajo, por la naturaleza de las faenas no est√° habilitado para negociar colectivamente. 
        </p>
        <p class="clausula">  
        <b>DECIMO:</b> El trabajador deja constancia que se encuentra afiliado para los efectos de su previsi√≥n a AFP ______________  y  para los efectos de salud a ___________ y reconoce que son de su responsabilidad todos los cambios o modificaciones que puedan afectar su situaci√≥n previsional o de salud, los que deber√° informar oportunamente al Empleador. 
        </p>
        <p class="clausula">  
        <b>UNDECIMO:</b> Se deja expresa constancia   que el trabajador   ingres√≥   al servicio del empleador el ___/___/20__. 
        </p>
        <p class="clausula">  
        <b>DUODECIMO:</b> Para todos los efectos derivados del presente contrato las partes fijan domicilio en la ciudad de Talca  y se someten a la Jurisdicci√≥n de sus Tribunales. 
        </p>
        <p class="clausula">  
        <b>D√âCIMO TERCERO:</b> El presente contrato se firma en 2 ejemplares, declarando el trabajador haber recibido en este acto un ejemplar de dicho instrumento, que es el fiel reflejo de la relaci√≥n laboral convenida. 
        </p>

        <br><br><br>

<div class="signatures">

    <!-- EMPLEADOR -->
    <div class="sign">
        <div class="line"></div>

        <p class="sign-name">
            Servicios Agr√≠colas San Ger√≥nimo SPA
        </p>

        <p class="sign-role">
            EMPLEADOR
        </p>

        <p class="sign-rut">
            RUT: 78.018.478-7
        </p>
    </div>


    <!-- TRABAJADOR -->
    <div class="sign">
        <div class="line"></div>

        <p class="sign-name">
            TRABAJADOR
        </p>
    </div>

</div>

    </div>
    <button class="no-print" onclick="window.print()">
        üñ®Ô∏è Imprimir Contrato
    </button>
        </section>

        <!-- MENSUAL -->
        <section class="card view hidden" id="viewMonthly">
            <h2>Resumen Mensual por Trabajador</h2>

            <select id="workerMonthly"></select>
            <input type="month" id="monthMonthly">

            <button onclick="generateMonthlySummary()">
                Calcular Mes
            </button>

            <div id="monthlyResult"></div>
        </section>

        <!-- MENSUAL GENERAL -->
        <section class="card view hidden" id="viewMonthlyGeneral">
            <h2>Resumen Mensual General</h2>

            <input type="month" id="monthGeneral">

            <button onclick="generateMonthlyGeneral()">
                Calcular Mes
            </button>

            <div id="monthlyGeneralResult"></div>
        </section>

        <!-- SEMANAL -->
        <section class="card view hidden" id="viewWeekly">
            <h2>Resumen Semanal</h2>

            <button onclick="window.location.href='historial.html'">
                Ver Historial Completo
            </button>

            <input type="text"
                   id="searchWorkerWeekly"
                   placeholder="Buscar por nombre o RUT"
                   oninput="filterWorkersWeekly()">

            <select id="workerWeekly"></select>
            <input type="week" id="weekSelected">

            <button onclick="generateWeeklySummary()">
                Calcular Semana
            </button>

            <div id="weeklyResult"></div>
        </section>

        <!-- HISTORIAL -->
        <section class="card view hidden" id="viewHistory">
            <h2>Historial</h2>
            <div id="history"></div>
        </section>

        <!-- RESPALDO -->
        <section class="card view hidden" id="viewBackup">
            <h3>Respaldo del Sistema</h3>

            <button onclick="exportData()">Exportar Respaldo</button>

            <input type="file"
                   id="importFile"
                   style="display:none"
                   onchange="importData(event)">

            <button onclick="document.getElementById('importFile').click()">
                Importar Respaldo
            </button>
        </section>

    </main>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="app.js"></script>

</body>
</html>