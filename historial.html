<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Historial Completo</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="content">
      <header>
        <h1>Historial Completo de ProducciÃ³n</h1>
        <button onclick="goBack()">Volver al Sistema</button>
      </header>

      <!-- ===== ACCIONES ===== -->

      <div class="card">
        <h3>Borrar Registros por Mes</h3>

        <input type="month" id="deleteMonth" />

        <button onclick="deleteByMonth()" style="background: #e67e22">
          Borrar Mes Seleccionado
        </button>

        <hr style="margin: 20px 0" />

        <button onclick="clearHistory()" style="background: #c0392b">
          Borrar Todo el Historial
        </button>
      </div>

      <!-- ===== TOTALES ===== -->

      <div class="card" id="historyTotals"></div>

      <!-- ===== TABLA ===== -->

      <div class="card">
        <div id="history"></div>
      </div>
    </div>

    <script src="app.js"></script>

    <script>
      // =============================
      // ðŸš€ CARGA INICIAL
      // =============================

      renderHistory();
      renderTotals();

      // =============================
      // ðŸ”™ VOLVER
      // =============================

      function goBack() {
        window.location.href = "index.html";
      }

      // =============================
      // ðŸ—‘ï¸ BORRAR TODO
      // =============================

      function clearHistory() {
        if (!confirm("Â¿Borrar TODO el historial?")) return;

        localStorage.removeItem("history");

        history = [];

        renderHistory();
        renderTotals();
      }

      // =============================
      // ðŸ—‘ï¸ BORRAR POR MES
      // =============================

      function deleteByMonth() {
        const month = document.getElementById("deleteMonth").value;

        if (!month) {
          alert("Seleccione mes.");
          return;
        }

        if (!confirm("Â¿Borrar registros del mes seleccionado?")) return;

        history = history.filter((r) => !r.date.startsWith(month));

        localStorage.setItem("history", JSON.stringify(history));

        renderHistory();
        renderTotals();
      }

      // =============================
      // ðŸ“Š TOTALES
      // =============================

      function renderTotals() {
        const c = document.getElementById("historyTotals");

        if (history.length === 0) {
          c.innerHTML = "<h3>No hay registros.</h3>";

          return;
        }

        let total = 0;

        history.forEach((r) => (total += Number(r.total)));

        c.innerHTML = `
        <h3>Resumen HistÃ³rico</h3>
        <p><strong>Registros:</strong> ${history.length}</p>
        <p><strong>Total Pagado:</strong>
           $${total.toLocaleString("es-CL")}
        </p>
    `;
      }
    </script>
  </body>
</html>
